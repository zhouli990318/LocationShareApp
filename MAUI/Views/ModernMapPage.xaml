<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="LocationShareApp.Views.ModernMapPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             xmlns:viewmodels="clr-namespace:LocationShareApp.ViewModels"
             x:DataType="viewmodels:MainViewModel"
             Title=""
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="{StaticResource Surface}">

    <Grid>
        <!-- ä¸»åœ°å›¾åŒºåŸŸ -->
        <maps:Map x:Name="MapView"
                  IsShowingUser="True"
                  MapType="Street"
                  VerticalOptions="FillAndExpand"
                  HorizontalOptions="FillAndExpand"
                  MapClicked="OnMapClicked" />

        <!-- æ¸å˜é®ç½©å±‚ - é¡¶éƒ¨ -->
        <BoxView VerticalOptions="Start"
                 HeightRequest="120"
                 HorizontalOptions="FillAndExpand">
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#80FFFFFF" Offset="0.0" />
                    <GradientStop Color="#00FFFFFF" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <!-- é¡¶éƒ¨çŠ¶æ€æ å’Œå¯¼èˆª -->
        <Grid VerticalOptions="Start" 
              Padding="16,44,16,16"
              RowDefinitions="Auto,Auto">
            
            <!-- çŠ¶æ€æ ä¿¡æ¯ -->
            <Grid Grid.Row="0" 
                  ColumnDefinitions="Auto,*,Auto,Auto,Auto"
                  Margin="0,0,0,12">
                
                <!-- æ—¶é—´ -->
                <Label Grid.Column="0"
                       Text="13:33"
                       Style="{StaticResource MaterialSubtitle1}"
                       TextColor="{StaticResource OnSurface}"
                       VerticalOptions="Center" />
                
                <!-- ç½‘ç»œçŠ¶æ€ -->
                <StackLayout Grid.Column="2" 
                             Orientation="Horizontal" 
                             Spacing="4"
                             VerticalOptions="Center">
                    <Label Text="5G"
                           Style="{StaticResource MaterialCaption}"
                           TextColor="{StaticResource OnSurface}"
                           FontAttributes="Bold" />
                    <Label Text="68%"
                           Style="{StaticResource MaterialCaption}"
                           TextColor="{StaticResource Secondary}"
                           FontAttributes="Bold" />
                </StackLayout>
            </Grid>

            <!-- å¯¼èˆªæ  -->
            <Grid Grid.Row="1" 
                  ColumnDefinitions="Auto,*,Auto">
                
                <!-- è¿”å›žæŒ‰é’® -->
                <Button Grid.Column="0"
                        Text="â†"
                        Style="{StaticResource MaterialTextButton}"
                        FontSize="24"
                        WidthRequest="44"
                        HeightRequest="44"
                        CornerRadius="22"
                        BackgroundColor="#40FFFFFF"
                        TextColor="{StaticResource OnSurface}" />
                
                <!-- æ ‡é¢˜ -->
                <Label Grid.Column="1"
                       Text="å‘¨æŽ"
                       Style="{StaticResource MaterialSubtitle1}"
                       TextColor="{StaticResource OnSurface}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
                
                <!-- è®¾ç½®æŒ‰é’® -->
                <Button Grid.Column="2"
                        Text="âš™"
                        Style="{StaticResource MaterialTextButton}"
                        FontSize="20"
                        WidthRequest="44"
                        HeightRequest="44"
                        CornerRadius="22"
                        BackgroundColor="#40FFFFFF"
                        TextColor="{StaticResource OnSurface}" />
            </Grid>
        </Grid>

        <!-- ç”¨æˆ·ä½ç½®æ ‡è®° -->
        <Frame Style="{StaticResource MaterialAvatar}"
               VerticalOptions="Center"
               HorizontalOptions="Center"
               Margin="0,0,120,80"
               BackgroundColor="{StaticResource Primary}">
            <Label Text="å‘¨"
                   Style="{StaticResource MaterialBody1}"
                   TextColor="{StaticResource PrimaryDarkText}"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </Frame>

        <!-- æµ®åŠ¨æ“ä½œæŒ‰é’®ç»„ - å³ä¾§ -->
        <StackLayout VerticalOptions="Center"
                     HorizontalOptions="End"
                     Margin="0,0,16,0"
                     Spacing="12">
            
            <!-- å®šä½æŒ‰é’® -->
            <Button Style="{StaticResource MaterialMiniFAB}"
                    Text="ðŸ“"
                    FontSize="16"
                    Command="{Binding LocationCommand}" />
            
            <!-- å›¾å±‚æŒ‰é’® -->
            <Button Style="{StaticResource MaterialMiniFAB}"
                    Text="ðŸ—º"
                    FontSize="16"
                    Command="{Binding LayerCommand}" />
            
            <!-- å¥½å‹æŒ‰é’® -->
            <Button Style="{StaticResource MaterialMiniFAB}"
                    Text="ðŸ‘¥"
                    FontSize="16"
                    Command="{Binding FriendsCommand}" />
        </StackLayout>

        <!-- åº•éƒ¨ä¿¡æ¯é¢æ¿ -->
        <Frame Style="{StaticResource MaterialBottomNavigation}"
               VerticalOptions="End"
               HeightRequest="280"
               Margin="0">
            
            <Grid RowDefinitions="Auto,Auto,*">
                
                <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
                <Grid Grid.Row="0" 
                      Padding="20,16,20,8"
                      ColumnDefinitions="*,*,*,*,*">
                    
                    <Button Grid.Column="0"
                            Text="ä»Šå¤©"
                            Style="{StaticResource MaterialTextButton}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="{StaticResource PrimaryDarkText}"
                            CornerRadius="16"
                            FontSize="14" />
                    
                    <Button Grid.Column="1"
                            Text="æ˜¨å¤©"
                            Style="{StaticResource MaterialTextButton}"
                            TextColor="{StaticResource OnSurfaceVariant}"
                            FontSize="14" />
                    
                    <Button Grid.Column="2"
                            Text="7.15"
                            Style="{StaticResource MaterialTextButton}"
                            TextColor="{StaticResource OnSurfaceVariant}"
                            FontSize="14" />
                    
                    <Button Grid.Column="3"
                            Text="7.14"
                            Style="{StaticResource MaterialTextButton}"
                            TextColor="{StaticResource OnSurfaceVariant}"
                            FontSize="14" />
                    
                    <Button Grid.Column="4"
                            Text="7.13"
                            Style="{StaticResource MaterialTextButton}"
                            TextColor="{StaticResource OnSurfaceVariant}"
                            FontSize="14" />
                </Grid>

                <!-- è½¨è¿¹/å®šä½ç‚¹åˆ‡æ¢ -->
                <Grid Grid.Row="1" 
                      Padding="20,8,20,16"
                      ColumnDefinitions="*,*">
                    
                    <Button Grid.Column="0"
                            Text="è½¨è¿¹"
                            Style="{StaticResource MaterialTextButton}"
                            BackgroundColor="{StaticResource Secondary}"
                            TextColor="{StaticResource SecondaryDarkText}"
                            CornerRadius="16"
                            FontSize="14" />
                    
                    <Button Grid.Column="1"
                            Text="å®šä½ç‚¹"
                            Style="{StaticResource MaterialTextButton}"
                            TextColor="{StaticResource OnSurfaceVariant}"
                            FontSize="14" />
                </Grid>

                <!-- ä½ç½®ä¿¡æ¯åˆ—è¡¨ -->
                <ScrollView Grid.Row="2">
                    <StackLayout Spacing="0" Padding="20,0,20,20">
                        
                        <!-- å·¥ä½œåœºæ‰€ -->
                        <Grid Style="{StaticResource MaterialListItem}"
                              ColumnDefinitions="Auto,*,Auto"
                              Padding="0,16">
                            
                            <Frame Grid.Column="0"
                                   Style="{StaticResource MaterialAvatar}"
                                   WidthRequest="40"
                                   HeightRequest="40"
                                   CornerRadius="20"
                                   BackgroundColor="{StaticResource Secondary}">
                                <Label Text="ðŸ“"
                                       FontSize="18"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <StackLayout Grid.Column="1" 
                                         Spacing="4" 
                                         Margin="12,0,0,0"
                                         VerticalOptions="Center">
                                <Label Text="å·¥ä½œåœºæ‰€"
                                       Style="{StaticResource MaterialSubtitle1}" />
                                <Label Text="åœç•™1h34min â€¢ 5G"
                                       Style="{StaticResource MaterialCaption}" />
                            </StackLayout>
                            
                            <Label Grid.Column="2"
                                   Text="11:59"
                                   Style="{StaticResource MaterialCaption}"
                                   VerticalOptions="Start"
                                   Margin="0,4,0,0" />
                        </Grid>

                        <!-- æ­¥è¡Œè½¨è¿¹ -->
                        <Grid Style="{StaticResource MaterialListItem}"
                              ColumnDefinitions="Auto,*,Auto"
                              Padding="0,12">
                            
                            <Frame Grid.Column="0"
                                   Style="{StaticResource MaterialSmallAvatar}"
                                   BackgroundColor="{StaticResource MapAccent}">
                                <Label Text="ðŸš¶"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <StackLayout Grid.Column="1" 
                                         Spacing="2" 
                                         Margin="12,0,0,0"
                                         VerticalOptions="Center">
                                <Label Text="æ­¥è¡Œ"
                                       Style="{StaticResource MaterialBody2}"
                                       FontAttributes="Bold" />
                                <Label Text="0.35km â€¢ 28min â€¢ ä¸Žé€Ÿ0km/h â€¢ 5EBKJ"
                                       Style="{StaticResource MaterialCaption}" />
                            </StackLayout>
                            
                            <Label Grid.Column="2"
                                   Text="11:31"
                                   Style="{StaticResource MaterialCaption}"
                                   VerticalOptions="Start" />
                        </Grid>

                        <!-- åˆ†éš”çº¿ -->
                        <BoxView Style="{StaticResource MaterialDivider}" 
                                 Margin="52,8,0,8" />

                        <!-- å…¶ä»–ä½ç½®è®°å½•... -->
                        <Grid Style="{StaticResource MaterialListItem}"
                              ColumnDefinitions="Auto,*,Auto"
                              Padding="0,16">
                            
                            <Frame Grid.Column="0"
                                   Style="{StaticResource MaterialAvatar}"
                                   WidthRequest="40"
                                   HeightRequest="40"
                                   CornerRadius="20"
                                   BackgroundColor="{StaticResource Secondary}">
                                <Label Text="ðŸ "
                                       FontSize="18"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Frame>
                            
                            <StackLayout Grid.Column="1" 
                                         Spacing="4" 
                                         Margin="12,0,0,0"
                                         VerticalOptions="Center">
                                <Label Text="å®¶"
                                       Style="{StaticResource MaterialSubtitle1}" />
                                <Label Text="åœç•™8h11min â€¢ CMCC-raRw-5G"
                                       Style="{StaticResource MaterialCaption}" />
                            </StackLayout>
                            
                            <Label Grid.Column="2"
                                   Text="00:00"
                                   Style="{StaticResource MaterialCaption}"
                                   VerticalOptions="Start"
                                   Margin="0,4,0,0" />
                        </Grid>
                    </StackLayout>
                </ScrollView>
            </Grid>
        </Frame>

        <!-- åœ°ç‚¹ç¼–è¾‘æŒ‰é’® -->
        <Button Text="ðŸ“ åœ°ç‚¹"
                Style="{StaticResource MaterialTextButton}"
                BackgroundColor="#E0FFFFFF"
                TextColor="{StaticResource OnSurface}"
                CornerRadius="20"
                Padding="16,8"
                FontSize="14"
                VerticalOptions="End"
                HorizontalOptions="Start"
                Margin="20,0,0,300" />

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <ActivityIndicator IsVisible="{Binding IsBusy}"
                           IsRunning="{Binding IsBusy}"
                           Color="{StaticResource Primary}"
                           BackgroundColor="#80000000"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
    </Grid>

</ContentPage>